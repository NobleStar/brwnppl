!!!
%html
  %head
    %title= "Brwnppl Mobile"
    %meta{ :name => "viewport", :content => "width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0;" }
    %meta{ :name => "apple-mobile-web-app-capable", :content => 'yes'}
    %meta{ :name => "apple-mobile-web-app-status-bar-style", :content => 'black-translucent'}

    <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    %link{ :rel => 'shortcut icon', :href => '/assets/favicon.png'}
    :plain
      <style type='text/css'>
        #jqt ul li a {
          text-overflow: none;
          white-space: wrap;
        }

            div#jqt ul li {
                background-color: #ffeab1;
                color: #000;
                border-top: 1px solid #a2a14d;
            }
            div#jqt ul li input[type="checkbox"] {
                background-color: #e8a322;
                border: 2px solid #e8a322;
            }
            div#jqt ul li input[type="text"], div#jqt ul li textarea {
                background-color: #ffeab1;
            }
            div#jqt textarea {
                background-color: #e8a322;
            }
            div#jqt .complete span {
                text-decoration: line-through;
            }
            div#jqt li small {
                opacity: 0;
                overflow: hidden;
                width: 0 !important;
                -webkit-transition: 250ms all ease-in-out;
            }
            div#jqt li.editingmode small {
                opacity: 1;
                width: 50% !important;
            }
            div#jqt .toolbar {
                background: url(data:image/gif;base64,R0lGODlhHQAsAMQAAFU9NUk0LYxkV2NGPX1ZTXJSRphtXoNeUWVIPk04MFxCOVE6MmpMQlpAOHVUSJ1wYmhLQG1ORFlAN1c/NnhXS2xOQkczLF5EO29QRWBEPE44MEo1LlI7M1A6Mkw3L2FFPCH5BAAAAAAALAAAAAAdACwAAAX/oPGMhkiaZXqiqSCU7vEabm3X8n3s/C70QBnwxyNQCAeCcqlMNp9GJPLoqC6thGrScaQ4pthuofCljKtVMuFsPFO8jnEBw3Vg7tw53nsn28d8GBERGGOCg4WDBYp6VYhch4h3GAwMhJQVBZURcYOMDJmglRWVlZSllRCFDBCmGBCtgqytqbC2graWsxG7r7awCBAREMGws7+wERXEwMXNwgjRzLbRCMvEwQzRAwMIrNze1d3a4K0I3aTd59Ln4+3B1e+s8dwDlfXg7fj69fz4HwAHEAP4IVrADwIHEESIAOGHCxcUOrzwAcLDiRgX1ssAMQNHbh25efzIMUO0DAoi/15QoMAjSwUNWX5g6XGlyZkZANZs0CDiAJ4KBlxoEHSAgp5Hgw5NuZLlUKIceRKFeJRoVYpJjzYl2kCCBAUzvTLtahVoVZZSvaolqlZCz7Ruj8YN63UCgLpuJQCYMKGr3a8K/kqY4NbvXr58AewdfBixXcR+EQ9OnPhwA7uKETe2jFlzZsx7FV9WDGA06dOiSTdQzIEogA6qVa+WDYADB9a3bXOQoHtBbt13e7fW3cG2htsdinNYkLx2cee6o79Obls5dQ7HOSjXrjt7dw0aaoPXDn78AvC+y2tYoPi4+vILzpdP4D4B/eXqbd/vYN+DhuQaeNCffxok4B92Av6XnIsHDHrQwXkMFhdghB00+J+BDNInYIUZNthgfxgOaCGEDW5g4gYPenCigxqY6J+LGG7g4AYBrnhiByfm+KKOJwaQo4wb+Ljjj/8FGcCQFrxowZE4LpljAD7+aAGNCQSw5JIqPonlBhZMGaSNWHoQpZVdmtilil1u2eWRKlopJJZpypgmg3GiWaaJY4YAADs=) top left repeat-x;
                border: 0;
                border-bottom: 1px solid #000;
            }
            #jqt  > .edgetoedge, #jqt > * {
                background: #ffeab1 none;
            }
            div#jqt .toolbar .btn2 {
                -webkit-border-radius: 5px;
                -webkit-border-image: none;
                display: block;
                background: rgba(40, 29, 25, .4) none !important;
                padding: 6px;
                border: 1px solid #372823;
                float: left;
                color: #fff;
                -webkit-box-shadow: rgba(255,255,255, .4) 0 1px 0;
                text-decoration: none;
                position: absolute;
                top: 5px;
                right: 10px;
                font-size: 13px;
                text-shadow: #000 0 -1px 0;
                display: inline;
            }
            div#jqt .toolbar .left_button {
                -webkit-border-radius: 5px;
                -webkit-border-image: none;
                display: block;
                background: rgba(40, 29, 25, .4) none !important;
                padding: 6px;
                border: 1px solid #372823;
                float: left;
                color: #fff;
                -webkit-box-shadow: rgba(255,255,255, .4) 0 1px 0;
                text-decoration: none;
                position: absolute;
                top: 5px;
                left: 10px;
                font-size: 13px;
                text-shadow: #000 0 -1px 0;
                display: inline;
            }
            div#jqt .btn2.active {
                background-color: rgba(0,0,0,.5);
            }
            div#jqt .edgetoedge h4 {
                border: 0;
                background: url(data:image/gif;base64,R0lGODlhHQAsAMQAAFU9NUk0LYxkV2NGPX1ZTXJSRphtXoNeUWVIPk04MFxCOVE6MmpMQlpAOHVUSJ1wYmhLQG1ORFlAN1c/NnhXS2xOQkczLF5EO29QRWBEPE44MEo1LlI7M1A6Mkw3L2FFPCH5BAAAAAAALAAAAAAdACwAAAX/oPGMhkiaZXqiqSCU7vEabm3X8n3s/C70QBnwxyNQCAeCcqlMNp9GJPLoqC6thGrScaQ4pthuofCljKtVMuFsPFO8jnEBw3Vg7tw53nsn28d8GBERGGOCg4WDBYp6VYhch4h3GAwMhJQVBZURcYOMDJmglRWVlZSllRCFDBCmGBCtgqytqbC2graWsxG7r7awCBAREMGws7+wERXEwMXNwgjRzLbRCMvEwQzRAwMIrNze1d3a4K0I3aTd59Ln4+3B1e+s8dwDlfXg7fj69fz4HwAHEAP4IVrADwIHEESIAOGHCxcUOrzwAcLDiRgX1ssAMQNHbh25efzIMUO0DAoi/15QoMAjSwUNWX5g6XGlyZkZANZs0CDiAJ4KBlxoEHSAgp5Hgw5NuZLlUKIceRKFeJRoVYpJjzYl2kCCBAUzvTLtahVoVZZSvaolqlZCz7Ruj8YN63UCgLpuJQCYMKGr3a8K/kqY4NbvXr58AewdfBixXcR+EQ9OnPhwA7uKETe2jFlzZsx7FV9WDGA06dOiSTdQzIEogA6qVa+WDYADB9a3bXOQoHtBbt13e7fW3cG2htsdinNYkLx2cee6o79Obls5dQ7HOSjXrjt7dw0aaoPXDn78AvC+y2tYoPi4+vILzpdP4D4B/eXqbd/vYN+DhuQaeNCffxok4B92Av6XnIsHDHrQwXkMFhdghB00+J+BDNInYIUZNthgfxgOaCGEDW5g4gYPenCigxqY6J+LGG7g4AYBrnhiByfm+KKOJwaQo4wb+Ljjj/8FGcCQFrxowZE4LpljAD7+aAGNCQSw5JIqPonlBhZMGaSNWHoQpZVdmtilil1u2eWRKlopJJZpypgmg3GiWaaJY4YAADs=) top left repeat-x;
                color: #ffeab1;
                border-bottom: 1px solid #9d7062;
                border-top: 1px solid #9d7062;
            } 
            #jqt ul li a.story_comments{
              float: right;
              width: auto;
              font: bold 14px "Helvetica Neue", Helvetica;
            }
            #jqt ul li a span.up, #jqt ul li a span.down {
              width: auto;
              font: bold 18px "Helvetica Neue", Helvetica;
            }
            #jqt ul li a span.brownie_points {
              width: auto;
            }
            #jqt ul li a.up, #jqt ul li a.down, #jqt ul li a.brownie_points, #jqt ul li a.story_comments {
              display: inline-block;
              padding-top: 15px;
            }
        
      </style>
    = stylesheet_link_tag '/assets/jqtouch/themes/apple.css'
    = javascript_include_tag '/assets/jqtouch/jquery-1.7.2-min.js', '/assets/jqtouch/jqtouch.min.js', '/assets/jqtouch/jqtouch-jquery.min.js', '/assets/underscore.js', '/assets/Story/StoryController.js'
    = csrf_meta_tags
    :plain
      <script type="text/javascript" charset="utf-8">

          var jQT = new $.jQTouch({
            icon: 'jqtouch.png',
            icon4: 'jqtouch4.png',
            addGlossToIcon: false,
            startupScreen: 'jqt_startup.png',
            statusBar: 'black-translucent',
            preloadImages: [],
            slideupSelector: '.slideup'
          });

          $(document).ready(function() {
            $('#update_account').click(function() {
                action = $('.form').prop('action');
                data   = $('.form').serialize();
                requestType = $('.form').find('input[name=_method]').val();
                $.ajax({ 
                    url: action, 
                    data: data,
                    type: requestType,
                    dataType: 'json'
                });
            });

            $('.up_vote').click(function(event) {
                event.preventDefault();
                story_id = $(this).parents('li').data('story-id');
                story = new Brwnppl.StoryController(story_id);
                that = this
                story.like(function() {
                    span = $(that).parent().next().find('.brownie_points');
                    oldPoints = parseInt( span.text(), 10);
                    span.text( oldPoints + 1);
                    alert('Thanks for up-voting this story!');
                })
            });

            $('.down_vote').click(function(event) {
                event.preventDefault();
                story_id = $(this).parents('li').data('story-id');
                story = new Brwnppl.StoryController(story_id);
                that = this
                story.dislike(function() {
                    span = $(that).parent().prev().find('.brownie_points');
                    oldPoints = parseInt( span.text(), 10);
                    span.text( oldPoints - 1);
                    alert('Thanks for down-voting this story!');
                })
            });

          });
      </script>

  %body
    #jqt.supports3d.portrait
      = yield
